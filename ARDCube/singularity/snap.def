Bootstrap: localimage
From: /home/marco/pypypy/ARDCube/ARDCube/singularity/ubuntu.sif


%files 
    ./snap /


%post -c /bin/bash

    ######### SNAP #########

    # Create directory and move snap files
    mkdir -p /src
    mv /snap /src

    # SNAP wants the current folder '.' included in LD_LIBRARY_PATH
    export LD_LIBRARY_PATH=".:$LD_LIBRARY_PATH"

    # Install Java
    apt-get install default-jdk maven -y
    export JAVA_HOME="/usr/lib/jvm/java-11-openjdk-amd64/"

    # Install SNAP 
    echo -e "######################### \nRunning /src/snap/install.sh \n#########################"
    bash /src/snap/install.sh

    # Cleanup
    apt-get -y autoremove --purge
    apt-get -y clean
    rm -rf /src


%environment
    export JAVA_HOME="/usr/lib/jvm/java-11-openjdk-amd64/"
    export LD_LIBRARY_PATH=".:$LD_LIBRARY_PATH"
    export PATH="$PATH:/usr/local/snap/bin/:/root/.snap/auxdata/gdal/gdal-3-0-0/bin"


%runscript
    /usr/local/snap/bin/snap
